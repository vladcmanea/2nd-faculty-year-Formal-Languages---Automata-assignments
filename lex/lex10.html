<html><head><title>LEX</title></head><body style='font-family:"courier new"'><span style='color: #060'>/*<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;Copyright&nbsp;2009,&nbsp;2010&nbsp;Vlad&nbsp;Manea,&nbsp;Sebastian&nbsp;Codrin&nbsp;Ditu<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;file&nbsp;is&nbsp;part&nbsp;of&nbsp;newshaolin.<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newshaolin&nbsp;is&nbsp;free&nbsp;software:&nbsp;you&nbsp;can&nbsp;redistribute&nbsp;it&nbsp;and/or&nbsp;modify<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it&nbsp;under&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;GNU&nbsp;General&nbsp;Public&nbsp;License&nbsp;as&nbsp;published&nbsp;by<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;Free&nbsp;Software&nbsp;Foundation,&nbsp;either&nbsp;version&nbsp;3&nbsp;of&nbsp;the&nbsp;License,&nbsp;or<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(at&nbsp;your&nbsp;option)&nbsp;any&nbsp;later&nbsp;version.<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newshaolin&nbsp;is&nbsp;distributed&nbsp;in&nbsp;the&nbsp;hope&nbsp;that&nbsp;it&nbsp;will&nbsp;be&nbsp;useful,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;but&nbsp;WITHOUT&nbsp;ANY&nbsp;WARRANTY;&nbsp;without&nbsp;even&nbsp;the&nbsp;implied&nbsp;warranty&nbsp;of<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MERCHANTABILITY&nbsp;or&nbsp;FITNESS&nbsp;FOR&nbsp;A&nbsp;PARTICULAR&nbsp;PURPOSE.&nbsp;&nbsp;See&nbsp;the<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GNU&nbsp;General&nbsp;Public&nbsp;License&nbsp;for&nbsp;more&nbsp;details.<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;You&nbsp;should&nbsp;have&nbsp;received&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;GNU&nbsp;General&nbsp;Public&nbsp;License<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;along&nbsp;with&nbsp;newshaolin.&nbsp;&nbsp;If&nbsp;not,&nbsp;see&nbsp;&lt;http://www.gnu.org/licenses/&gt;.<br /><br />*/</span><br /><br /><span style='color: #f60'>#include&nbsp;"newssql.h"</span><br /><span style='color: #f60'>#include&nbsp;"globals.h"</span><br /><br /><span style='color: #060'>/*&nbsp;definesc&nbsp;functia&nbsp;de&nbsp;adaugare&nbsp;a&nbsp;unei&nbsp;stiri,&nbsp;care&nbsp;intoarce&nbsp;identificatorul&nbsp;stirii&nbsp;adaugate&nbsp;*/</span><br /><span style='color: #009'>int</span>&nbsp;<span style='color: #900'>sql_new_add</span><span style='color: #660'>(</span><span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>name</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>text</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>catid</span><span style='color: #660'>)</span><br /><span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>ans</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;interogarea&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;conexiunea&nbsp;la&nbsp;serverul&nbsp;MySQL&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;rezultatul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL_RES</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;randul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL_ROW</span>&nbsp;<span style='color: #666'>row</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;aloc&nbsp;memorie&nbsp;pentru&nbsp;query&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #660'>(</span><span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #660'>)</span><span style='color: #900'>realloc</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>sizeof</span><span style='color: #660'>(</span><span style='color: #009'>char</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #660'>(</span><span style='color: #066'>128</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #666'>inlength</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_add::realloc(query,&nbsp;128&nbsp;+&nbsp;inlength)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;initializez&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_init</span><span style='color: #660'>(</span><span style='color: #666'>NULL</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_add::mysql_init(conn)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;conectez&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_real_connect</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"localhost"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"rcnews"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_add::mysql_real_connect(conn,&nbsp;rcnews)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;creez&nbsp;sirul&nbsp;de&nbsp;caractere&nbsp;pentru&nbsp;query&nbsp;INSERT&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"INSERT&nbsp;INTO&nbsp;news&nbsp;VALUES&nbsp;('',&nbsp;'%s',&nbsp;'%s',&nbsp;CONCAT(CURRENT_DATE(),&nbsp;'&nbsp;',&nbsp;CURRENT_TIME()),&nbsp;'%d',&nbsp;'%d');"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>name</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>text</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>catid</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>connected</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;adaug&nbsp;stirea,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_query</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>query</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_add::mysql_query(conn,&nbsp;insert)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;creez&nbsp;sirul&nbsp;de&nbsp;caractere&nbsp;pentru&nbsp;query&nbsp;SELECT&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"SELECT&nbsp;id&nbsp;FROM&nbsp;news&nbsp;WHERE&nbsp;category_id='%d'&nbsp;and&nbsp;user_id='%d'&nbsp;and&nbsp;name='%s'&nbsp;and&nbsp;text='%s';"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>catid</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>connected</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>name</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>text</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;aflu&nbsp;stirea,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_query</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>query</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_add::mysql_query(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;citesc&nbsp;rezultatul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_store_result</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_add::mysql_store_result(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;verific&nbsp;valoarea&nbsp;raspunsului&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>row</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_fetch_row</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;retin&nbsp;primul&nbsp;camp&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ans</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>atoi</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;consider&nbsp;utilizator&nbsp;fictiv,&nbsp;dar&nbsp;e&nbsp;posibil&nbsp;sa&nbsp;fi&nbsp;fost&nbsp;sters!&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ans</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;eliberez&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>mysql_free_result</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;inchid&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>mysql_close</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;intorc&nbsp;raspunsul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span>&nbsp;<span style='color: #666'>ans</span><span style='color: #999'>;</span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><span style='color: #990'>}</span><br /><br /><span style='color: #060'>/*&nbsp;definesc&nbsp;functia&nbsp;de&nbsp;modificare&nbsp;a&nbsp;unei&nbsp;stiri,&nbsp;care&nbsp;intoarce&nbsp;idul&nbsp;stirii&nbsp;modificate&nbsp;*/</span><br /><span style='color: #009'>int</span>&nbsp;<span style='color: #900'>sql_new_modify</span><span style='color: #660'>(</span><span style='color: #009'>int</span>&nbsp;<span style='color: #666'>id</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>name</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>text</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>catid</span><span style='color: #660'>)</span><br /><span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>ans</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;interogarea&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;conexiunea&nbsp;la&nbsp;serverul&nbsp;MySQL&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;rezultatul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL_RES</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;randul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL_ROW</span>&nbsp;<span style='color: #666'>row</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;aloc&nbsp;memorie&nbsp;pentru&nbsp;query&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #660'>(</span><span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #660'>)</span><span style='color: #900'>realloc</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>sizeof</span><span style='color: #660'>(</span><span style='color: #009'>char</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #660'>(</span><span style='color: #066'>128</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #666'>inlength</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_modify::realloc(query,&nbsp;128&nbsp;+&nbsp;inlength)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;initializez&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_init</span><span style='color: #660'>(</span><span style='color: #666'>NULL</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_modify::mysql_init(conn)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;conectez&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_real_connect</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"localhost"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"rcnews"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_modify::mysql_real_connect(conn,&nbsp;rcnews)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;creez&nbsp;sirul&nbsp;de&nbsp;caractere&nbsp;pentru&nbsp;query&nbsp;INSERT&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"UPDATE&nbsp;news&nbsp;SET&nbsp;name='%s',&nbsp;moment=CONCAT(CURRENT_DATE(),&nbsp;'&nbsp;',&nbsp;CURRENT_TIME()),&nbsp;text='%s',&nbsp;category_id='%d'&nbsp;WHERE&nbsp;id='%d';"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>name</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>text</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>catid</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>id</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;adaug&nbsp;stirea,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_query</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>query</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ans</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ans</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>id</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;eliberez&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>mysql_free_result</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;inchid&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>mysql_close</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;intorc&nbsp;raspunsul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span>&nbsp;<span style='color: #666'>ans</span><span style='color: #999'>;</span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><span style='color: #990'>}</span><br /><br /><span style='color: #060'>/*&nbsp;definesc&nbsp;functia&nbsp;de&nbsp;stergere&nbsp;a&nbsp;unei&nbsp;stiri&nbsp;*/</span><br /><span style='color: #009'>int</span>&nbsp;<span style='color: #900'>sql_new_remove</span><span style='color: #660'>(</span><span style='color: #009'>int</span>&nbsp;<span style='color: #666'>id</span><span style='color: #660'>)</span><br /><span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>ans</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;interogarea&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;conexiunea&nbsp;la&nbsp;serverul&nbsp;MySQL&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;aloc&nbsp;memorie&nbsp;pentru&nbsp;query&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #660'>(</span><span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #660'>)</span><span style='color: #900'>realloc</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>sizeof</span><span style='color: #660'>(</span><span style='color: #009'>char</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #660'>(</span><span style='color: #066'>128</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #666'>inlength</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_remove::realloc(query,&nbsp;128&nbsp;+&nbsp;inlength)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;initializez&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_init</span><span style='color: #660'>(</span><span style='color: #666'>NULL</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_remove::mysql_init(conn)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;conectez&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_real_connect</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"localhost"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"rcnews"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_remove::mysql_real_connect(conn,&nbsp;rcnews)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;construiesc&nbsp;cererea&nbsp;sql&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"DELETE&nbsp;FROM&nbsp;news&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;'%d';"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>id</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;adaug&nbsp;stirea,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_query</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>query</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_remove::mysql_query(conn,&nbsp;insert)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;am&nbsp;sters&nbsp;cu&nbsp;succes&nbsp;stirea&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span>&nbsp;<span style='color: #066'>1</span><span style='color: #999'>;</span><br /><span style='color: #990'>}</span><br /><br /><span style='color: #060'>/*&nbsp;definesc&nbsp;functia&nbsp;recursiva&nbsp;de&nbsp;vizualizare&nbsp;a&nbsp;stirilor&nbsp;*/</span><br /><span style='color: #009'>void</span>&nbsp;<span style='color: #900'>sql_news_view</span><span style='color: #660'>(</span><span style='color: #009'>int</span>&nbsp;<span style='color: #666'>catid</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>levmax</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>lev</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>limit</span><span style='color: #660'>)</span><br /><span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;verifica&nbsp;validitatea&nbsp;categoriei&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>user</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;identificatorul&nbsp;categoriei&nbsp;curente&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>id</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;numarul&nbsp;nivelului&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>char</span>&nbsp;<span style='color: #666'>number</span><span style='color: #909'>[</span><span style='color: #066'>11</span><span style='color: #909'>]</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;interogarea&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;conexiunea&nbsp;la&nbsp;serverul&nbsp;MySQL&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;rezultatul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL_RES</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;randul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL_ROW</span>&nbsp;<span style='color: #666'>row</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;verific&nbsp;sa&nbsp;nu&nbsp;fi&nbsp;depasit&nbsp;nivelul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>levmax</span>&nbsp;<span style='color: #909'>&gt;</span>&nbsp;<span style='color: #066'>0</span>&nbsp;<span style='color: #909'>&&</span>&nbsp;<span style='color: #666'>lev</span>&nbsp;<span style='color: #909'>&gt;=</span>&nbsp;<span style='color: #666'>levmax</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;intorc&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;initializez&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_init</span><span style='color: #660'>(</span><span style='color: #666'>NULL</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_news_view::mysql_init(conn)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;conectez&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_real_connect</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"localhost"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"rcnews"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_news_view::mysql_real_connect(conn,&nbsp;rcnews)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;aloc&nbsp;memorie&nbsp;pentru&nbsp;query&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #660'>(</span><span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #660'>)</span><span style='color: #900'>realloc</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>sizeof</span><span style='color: #660'>(</span><span style='color: #009'>char</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #660'>(</span><span style='color: #066'>128</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #666'>inlength</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_news_view::realloc(query,&nbsp;128&nbsp;+&nbsp;inlength)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;verific&nbsp;validitatea&nbsp;categoriei&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>user</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>sql_cat_user_exists</span><span style='color: #660'>(</span><span style='color: #666'>catid</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>&lt;=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;creez&nbsp;sirul&nbsp;de&nbsp;caractere&nbsp;pentru&nbsp;query&nbsp;SELECT&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"SELECT&nbsp;id&nbsp;FROM&nbsp;categories&nbsp;WHERE&nbsp;parent_id&nbsp;IS&nbsp;NULL;"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;gasesc&nbsp;categoriile,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_query</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>query</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_news_view::mysql_query(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;retin&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_store_result</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_news_view::mysql_store_result(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;parcurg&nbsp;intrarile&nbsp;selectate&nbsp;din&nbsp;baza&nbsp;de&nbsp;date&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>while</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>row</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_fetch_row</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;retin&nbsp;valoarea&nbsp;identificatorului*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>id</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>atoi</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>&gt;</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;reapelez&nbsp;cu&nbsp;categorie&nbsp;valida&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sql_news_view</span><span style='color: #660'>(</span><span style='color: #666'>id</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>levmax</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>lev</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>limit</span><span style='color: #660'>)</span><span style='color: #999'>;</span>&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;tratez&nbsp;si&nbsp;celalalt&nbsp;caz&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;trec&nbsp;la&nbsp;randul&nbsp;urmator&nbsp;extras&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>continue</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;tratez&nbsp;cazul&nbsp;cand&nbsp;categoria&nbsp;e&nbsp;valida&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;creez&nbsp;sirul&nbsp;de&nbsp;caractere&nbsp;pentru&nbsp;query&nbsp;SELECT&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>limit</span>&nbsp;<span style='color: #909'>&gt;</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"SELECT&nbsp;id,&nbsp;name,&nbsp;text,&nbsp;moment,&nbsp;category_id,&nbsp;user_id&nbsp;FROM&nbsp;news&nbsp;WHERE&nbsp;category_id&nbsp;=&nbsp;'%d'&nbsp;ORDER&nbsp;BY&nbsp;moment&nbsp;DESC&nbsp;LIMIT&nbsp;%d;"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>catid</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>limit</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"SELECT&nbsp;id,&nbsp;name,&nbsp;text,&nbsp;moment,&nbsp;category_id,&nbsp;user_id&nbsp;FROM&nbsp;news&nbsp;WHERE&nbsp;category_id&nbsp;=&nbsp;'%d'&nbsp;ORDER&nbsp;BY&nbsp;moment&nbsp;DESC;"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>catid</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;gasesc&nbsp;stirile,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_query</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>query</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_news_view::mysql_query(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;retin&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_store_result</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_news_view::mysql_store_result(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;parcurg&nbsp;intrarile&nbsp;selectate&nbsp;din&nbsp;baza&nbsp;de&nbsp;date&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>while</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>row</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_fetch_row</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;construiesc&nbsp;numarul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>number</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"%d"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>lev</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspus&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;nivelul&nbsp;in&nbsp;raspuns&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>number</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspus&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;identificatorul&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspus&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;numele&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspus&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;textul&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspus&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;momentul&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>3</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspus&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;categoria&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>4</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspus&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;identificatorul&nbsp;propunatorului&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>5</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;creez&nbsp;sirul&nbsp;de&nbsp;caractere&nbsp;pentru&nbsp;query&nbsp;SELECT&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"SELECT&nbsp;id&nbsp;FROM&nbsp;categories&nbsp;WHERE&nbsp;parent_id&nbsp;=&nbsp;'%d';"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>catid</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;gasesc&nbsp;categoriile,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_query</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>query</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_news_view::mysql_query(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;retin&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_store_result</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_news_view::mysql_store_result(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;parcurg&nbsp;intrarile&nbsp;selectate&nbsp;din&nbsp;baza&nbsp;de&nbsp;date&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>while</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>row</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_fetch_row</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;retin&nbsp;valoarea&nbsp;identificatorului*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>id</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>atoi</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>&gt;</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;reapelez&nbsp;cu&nbsp;categorie&nbsp;valida&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sql_news_view</span><span style='color: #660'>(</span><span style='color: #666'>id</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>levmax</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>lev</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #066'>1</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>limit</span><span style='color: #660'>)</span><span style='color: #999'>;</span>&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;tratez&nbsp;si&nbsp;celalalt&nbsp;caz&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;trec&nbsp;la&nbsp;randul&nbsp;urmator&nbsp;extras&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>continue</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;eliberez&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>mysql_free_result</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;inchid&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>mysql_close</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><span style='color: #990'>}</span><br /><br /><span style='color: #060'>/*&nbsp;definesc&nbsp;functia&nbsp;de&nbsp;vizualizareaa&nbsp;a&nbsp;news&nbsp;*/</span><br /><span style='color: #009'>int</span>&nbsp;<span style='color: #900'>sql_new_view</span><span style='color: #660'>(</span><span style='color: #009'>int</span>&nbsp;<span style='color: #666'>id</span><span style='color: #660'>)</span><br /><span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;raspunsul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>ans</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;interogarea&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;conexiunea&nbsp;la&nbsp;serverul&nbsp;MySQL&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;rezultatul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL_RES</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;randul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL_ROW</span>&nbsp;<span style='color: #666'>row</span><span style='color: #999'>;</span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;aloc&nbsp;memorie&nbsp;pentru&nbsp;query&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #660'>(</span><span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #660'>)</span><span style='color: #900'>realloc</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>sizeof</span><span style='color: #660'>(</span><span style='color: #009'>char</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #660'>(</span><span style='color: #066'>128</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #666'>inlength</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_view::realloc(query,&nbsp;128&nbsp;+&nbsp;inlength)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;initializez&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_init</span><span style='color: #660'>(</span><span style='color: #666'>NULL</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_view::mysql_init(conn)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;conectez&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_real_connect</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"localhost"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"rcnews"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_view::mysql_real_connect(conn,&nbsp;rcnews)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;creez&nbsp;sirul&nbsp;de&nbsp;caractere&nbsp;pentru&nbsp;query&nbsp;SELECT&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"SELECT&nbsp;*&nbsp;FROM&nbsp;news&nbsp;WHERE&nbsp;id&nbsp;='%d';"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>id</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;gasesc&nbsp;utilizatorul,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_query</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>query</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_view::mysql_query(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;retin&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_store_result</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_view::mysql_store_result(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;parcurg&nbsp;intrarile&nbsp;selectate&nbsp;din&nbsp;baza&nbsp;de&nbsp;date&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>row</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_fetch_row</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;construiesc&nbsp;raspunsul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"success"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspuns&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;identificatorul&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspuns&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;numele&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspuns&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;textul&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspuns&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;momentul&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>3</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspuns&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;categoria&nbsp;parinte&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>4</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;bara&nbsp;in&nbsp;raspuns&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #090'>"|"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;identificatorul&nbsp;propunatorului&nbsp;stirii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>5</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;raspunsul&nbsp;este&nbsp;valid&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ans</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #066'>1</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;scriu&nbsp;eroare&nbsp;de&nbsp;id&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_output</span><span style='color: #660'>(</span><span style='color: #666'>errors</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;raspunsul&nbsp;este&nbsp;invalid&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ans</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;eliberez&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>mysql_free_result</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;inchid&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>mysql_close</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;intorc&nbsp;starea&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span>&nbsp;<span style='color: #666'>ans</span><span style='color: #999'>;</span><br /><span style='color: #990'>}</span><br /><br /><br /><span style='color: #060'>/*&nbsp;definesc&nbsp;functia&nbsp;de&nbsp;test&nbsp;a&nbsp;existentei&nbsp;unei&nbsp;stiri&nbsp;dupa&nbsp;id&nbsp;*/</span><br /><span style='color: #009'>int</span>&nbsp;<span style='color: #900'>sql_new_user_exists</span><span style='color: #660'>(</span><span style='color: #009'>int</span>&nbsp;<span style='color: #666'>id</span><span style='color: #660'>)</span><br /><span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;interogarea&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>int</span>&nbsp;<span style='color: #666'>ans</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;conexiunea&nbsp;la&nbsp;serverul&nbsp;MySQL&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;rezultatul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL_RES</span>&nbsp;<span style='color: #909'>*</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;declar&nbsp;variabila&nbsp;care&nbsp;retine&nbsp;randul&nbsp;interogarii&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>MYSQL_ROW</span>&nbsp;<span style='color: #666'>row</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;aloc&nbsp;memorie&nbsp;pentru&nbsp;query&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>query</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #660'>(</span><span style='color: #009'>char</span>&nbsp;<span style='color: #909'>*</span><span style='color: #660'>)</span><span style='color: #900'>realloc</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>sizeof</span><span style='color: #660'>(</span><span style='color: #009'>char</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #660'>(</span><span style='color: #066'>128</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #666'>inlength</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_user_exists::realloc(query,&nbsp;128&nbsp;+&nbsp;inlength)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;initializez&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>conn</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_init</span><span style='color: #660'>(</span><span style='color: #666'>NULL</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_user_exists::mysql_init(conn)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;conectez&nbsp;la&nbsp;baza&nbsp;de&nbsp;date,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_real_connect</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"localhost"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"root"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"rcnews"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_user_exists::mysql_real_connect(conn,&nbsp;rcnews)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;creez&nbsp;sirul&nbsp;de&nbsp;caractere&nbsp;pentru&nbsp;query&nbsp;SELECT&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>sprintf</span><span style='color: #660'>(</span><span style='color: #666'>query</span><span style='color: #999'>,</span>&nbsp;<span style='color: #090'>"SELECT&nbsp;user_id&nbsp;FROM&nbsp;news&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;'%d';"</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>id</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;gasesc&nbsp;utilizatorul,&nbsp;CU&nbsp;TRATAREA&nbsp;ERORILOR&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>mysql_query</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>query</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_user_exists::mysql_query(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #660'>(</span><span style='color: #666'>result</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_store_result</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>NULL</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>handle_error</span><span style='color: #660'>(</span><span style='color: #090'>"newssql::sql_new_user_exists::mysql_store_result(conn,&nbsp;select)"</span><span style='color: #660'>)</span><span style='color: #999'>;</span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;verific&nbsp;daca&nbsp;am&nbsp;raspuns&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>row</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>mysql_fetch_row</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;retin&nbsp;primul&nbsp;camp&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ans</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>atoi</span><span style='color: #660'>(</span><span style='color: #666'>row</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;verific&nbsp;celalalt&nbsp;caz&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;consider&nbsp;stire&nbsp;fictiva,&nbsp;dar&nbsp;e&nbsp;posibil&nbsp;sa&nbsp;fi&nbsp;fost&nbsp;stearsa!&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ans</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;eliberez&nbsp;rezultatul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>mysql_free_result</span><span style='color: #660'>(</span><span style='color: #666'>result</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;inchid&nbsp;conexiunea&nbsp;la&nbsp;baza&nbsp;de&nbsp;date&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>mysql_close</span><span style='color: #660'>(</span><span style='color: #666'>conn</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>/*&nbsp;intorc&nbsp;raspunsul&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span>&nbsp;<span style='color: #666'>ans</span><span style='color: #999'>;</span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><span style='color: #990'>}</span><br /><hr /><b>Definitii de functii (antet)</b><hr />int&nbsp;sql_new_add(char&nbsp;*name,&nbsp;char&nbsp;*text,&nbsp;int&nbsp;catid)<br /><br />int&nbsp;sql_new_modify(int&nbsp;id,&nbsp;char&nbsp;*name,&nbsp;char&nbsp;*text,&nbsp;int&nbsp;catid)<br /><br />int&nbsp;sql_new_remove(int&nbsp;id)<br /><br />void&nbsp;sql_news_view(int&nbsp;catid,&nbsp;int&nbsp;levmax,&nbsp;int&nbsp;lev,&nbsp;int&nbsp;limit)<br /><br />int&nbsp;sql_new_view(int&nbsp;id)<br /><br />int&nbsp;sql_new_user_exists(int&nbsp;id)<br /><br /><hr /><b>Apeluri de functii si de cate ori</b><hr />realloc de 6 ori<br />sizeof de 6 ori<br />handle_error de 32 ori<br />mysql_init de 6 ori<br />mysql_real_connect de 6 ori<br />sprintf de 10 ori<br />mysql_query de 9 ori<br />mysql_store_result de 6 ori<br />mysql_fetch_row de 6 ori<br />atoi de 4 ori<br />mysql_free_result de 5 ori<br />mysql_close de 5 ori<br />sql_cat_user_exists o data<br />sql_news_view de 2 ori<br />handle_output de 28 ori<br /><hr /><b>Tipuri predefinite utilizate</b><hr />int<br />char<br />void<br /></body></html>