<html><head><title>LEX</title></head><body style='font-family:"courier new"'><span style='color: #f60'>#include&nbsp;"RSA.h"</span><br /><br /><span style='color: #009'>class</span>&nbsp;<span style='color: #009'>RSA</span><br /><span style='color: #990'>{</span><br /><span style='color: #990'>}</span><span style='color: #999'>;</span><br /><br /><span style='color: #060'>//&nbsp;computes&nbsp;x&nbsp;^&nbsp;p&nbsp;mod&nbsp;n</span><br /><span style='color: #666'>ZZ</span>&nbsp;<span style='color: #009'>RSA</span><span style='color: #909'>::</span><span style='color: #900'>ModPower</span><span style='color: #660'>(</span><span style='color: #009'>const</span>&nbsp;<span style='color: #666'>ZZ</span>&nbsp;<span style='color: #909'>&</span><span style='color: #666'>x</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>const</span>&nbsp;<span style='color: #666'>ZZ</span>&nbsp;<span style='color: #909'>&</span><span style='color: #666'>p</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>const</span>&nbsp;<span style='color: #666'>ZZ</span>&nbsp;<span style='color: #909'>&</span><span style='color: #666'>n</span><span style='color: #660'>)</span><br /><span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;answer</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ZZ</span>&nbsp;<span style='color: #666'>a</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>to_ZZ</span><span style='color: #660'>(</span><span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;count&nbsp;power&nbsp;logarithm</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>long</span>&nbsp;<span style='color: #666'>k</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>NumBits</span><span style='color: #660'>(</span><span style='color: #666'>p</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;logarithmic&nbsp;exponentiation</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>for</span>&nbsp;<span style='color: #660'>(</span><span style='color: #009'>long</span>&nbsp;<span style='color: #666'>i</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>k</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #066'>1</span><span style='color: #999'>;</span>&nbsp;<span style='color: #666'>i</span>&nbsp;<span style='color: #909'>&gt;=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>;</span>&nbsp;<span style='color: #666'>i</span><span style='color: #909'>--</span><span style='color: #660'>)</span>&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;squared&nbsp;for&nbsp;ans</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>a</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>ZZ</span><span style='color: #909'>::</span><span style='color: #900'>SqrMod</span><span style='color: #660'>(</span><span style='color: #666'>a</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>n</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;if&nbsp;power&nbsp;has&nbsp;ith&nbsp;bit</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>bit</span><span style='color: #660'>(</span><span style='color: #666'>p</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>i</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span>&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;multiply&nbsp;a</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>a</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>MulMod</span><span style='color: #660'>(</span><span style='color: #666'>a</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>x</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>n</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;return&nbsp;answer</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span>&nbsp;<span style='color: #666'>a</span><span style='color: #999'>;</span><br /><span style='color: #990'>}</span><br /><br /><span style='color: #060'>//&nbsp;returns&nbsp;x&nbsp;^&nbsp;e&nbsp;mod&nbsp;n</span><br /><span style='color: #009'>void</span>&nbsp;<span style='color: #009'>RSA</span><span style='color: #909'>::</span><span style='color: #900'>applyEncrypt</span><span style='color: #660'>(</span><span style='color: #009'>istream</span>&nbsp;<span style='color: #909'>&</span><span style='color: #666'>fc</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>istream</span>&nbsp;<span style='color: #909'>&</span><span style='color: #666'>fp</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>ostream</span>&nbsp;<span style='color: #909'>&</span><span style='color: #666'>fa</span><span style='color: #660'>)</span><br /><span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;variables</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ZZ</span>&nbsp;<span style='color: #666'>n</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>e</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>a</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>x</span><span style='color: #999'>;</span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;read&nbsp;in&nbsp;public&nbsp;n</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fp</span>&nbsp;<span style='color: #909'>&gt;&gt;</span>&nbsp;<span style='color: #666'>n</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyEncrypt]&nbsp;Could&nbsp;not&nbsp;read&nbsp;public&nbsp;n"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;read&nbsp;in&nbsp;public&nbsp;e</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fp</span>&nbsp;<span style='color: #909'>&gt;&gt;</span>&nbsp;<span style='color: #666'>e</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyEncrypt]&nbsp;Could&nbsp;not&nbsp;read&nbsp;public&nbsp;e"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;read&nbsp;in&nbsp;plain&nbsp;x</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fc</span>&nbsp;<span style='color: #909'>&gt;&gt;</span>&nbsp;<span style='color: #666'>x</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyEncrypt]&nbsp;Could&nbsp;not&nbsp;read&nbsp;plain&nbsp;x"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;test&nbsp;x</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>x</span>&nbsp;<span style='color: #909'>&lt;=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyEncrypt]&nbsp;Plain&nbsp;x&nbsp;is&nbsp;too&nbsp;small"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;x&nbsp;^&nbsp;e&nbsp;mod&nbsp;n&nbsp;in&nbsp;answer</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;PowerMod&nbsp;exists&nbsp;and&nbsp;can&nbsp;be&nbsp;used&nbsp;like&nbsp;this&nbsp;too</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>a</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>ModPower</span><span style='color: #660'>(</span><span style='color: #666'>x</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>e</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>n</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;write&nbsp;answer</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fa</span>&nbsp;<span style='color: #909'>&lt;&lt;</span>&nbsp;<span style='color: #666'>a</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyEncrypt]&nbsp;Could&nbsp;not&nbsp;write&nbsp;encrypted&nbsp;a"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><span style='color: #990'>}</span><br /><br /><span style='color: #060'>//&nbsp;returns&nbsp;y&nbsp;^&nbsp;d&nbsp;mod&nbsp;n</span><br /><span style='color: #009'>void</span>&nbsp;<span style='color: #009'>RSA</span><span style='color: #909'>::</span><span style='color: #900'>applyDecrypt</span><span style='color: #660'>(</span><span style='color: #009'>istream</span>&nbsp;<span style='color: #909'>&</span><span style='color: #666'>fc</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>istream</span>&nbsp;<span style='color: #909'>&</span><span style='color: #666'>fp</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>istream</span>&nbsp;<span style='color: #909'>&</span><span style='color: #666'>fs</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>ostream</span>&nbsp;<span style='color: #909'>&</span><span style='color: #666'>fa</span><span style='color: #660'>)</span><br /><span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ZZ</span>&nbsp;<span style='color: #666'>p</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>q</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>n</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>e</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>d</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>f</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>a</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>y</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>d1</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>d2</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>a1</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>a2</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>x1</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>x2</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>v</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>w</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>x</span><span style='color: #999'>;</span>&nbsp;&nbsp;&nbsp;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;read&nbsp;in&nbsp;public&nbsp;n</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fp</span>&nbsp;<span style='color: #909'>&gt;&gt;</span>&nbsp;<span style='color: #666'>n</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyDecrypt]&nbsp;Could&nbsp;not&nbsp;read&nbsp;public&nbsp;n"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;read&nbsp;in&nbsp;public&nbsp;e</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fp</span>&nbsp;<span style='color: #909'>&gt;&gt;</span>&nbsp;<span style='color: #666'>e</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyDecrypt]&nbsp;Could&nbsp;not&nbsp;read&nbsp;public&nbsp;e"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;read&nbsp;in&nbsp;secret&nbsp;p</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fs</span>&nbsp;<span style='color: #909'>&gt;&gt;</span>&nbsp;<span style='color: #666'>p</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyDecrypt]&nbsp;Could&nbsp;not&nbsp;read&nbsp;secret&nbsp;p"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;read&nbsp;in&nbsp;secret&nbsp;q</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fs</span>&nbsp;<span style='color: #909'>&gt;&gt;</span>&nbsp;<span style='color: #666'>q</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyDecrypt]&nbsp;Could&nbsp;not&nbsp;read&nbsp;secret&nbsp;q"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;read&nbsp;in&nbsp;secret&nbsp;d</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fs</span>&nbsp;<span style='color: #909'>&gt;&gt;</span>&nbsp;<span style='color: #666'>d</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyDecrypt]&nbsp;Could&nbsp;not&nbsp;read&nbsp;secret&nbsp;d"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;read&nbsp;in&nbsp;encrypted&nbsp;y</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fc</span>&nbsp;<span style='color: #909'>&gt;&gt;</span>&nbsp;<span style='color: #666'>y</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyDecrypt]&nbsp;Could&nbsp;not&nbsp;read&nbsp;encrypted&nbsp;y"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;test&nbsp;y</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>y</span>&nbsp;<span style='color: #909'>&lt;=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyDecrypt]&nbsp;Encrypted&nbsp;y&nbsp;is&nbsp;too&nbsp;small"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;standard&nbsp;decryption&nbsp;would&nbsp;have&nbsp;been&nbsp;like&nbsp;this:</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;a&nbsp;=&nbsp;ModPower(y,&nbsp;d,&nbsp;n);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;but&nbsp;now&nbsp;compute&nbsp;y&nbsp;^&nbsp;d&nbsp;mod&nbsp;n&nbsp;by&nbsp;using&nbsp;the&nbsp;Chinese&nbsp;Remainder&nbsp;Theorem</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;n1&nbsp;=&nbsp;d&nbsp;mod&nbsp;f(p)&nbsp;=&nbsp;d&nbsp;mod&nbsp;(p&nbsp;-&nbsp;1)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>rem</span><span style='color: #660'>(</span><span style='color: #666'>d1</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>d</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>p</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;n2&nbsp;=&nbsp;d&nbsp;mod&nbsp;f(p)&nbsp;=&nbsp;d&nbsp;mod&nbsp;(q&nbsp;-&nbsp;1)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>rem</span><span style='color: #660'>(</span><span style='color: #666'>d2</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>d</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>q</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;a1&nbsp;=&nbsp;y&nbsp;mod&nbsp;p</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>rem</span><span style='color: #660'>(</span><span style='color: #666'>a1</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>y</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>p</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;a2&nbsp;=&nbsp;y&nbsp;mod&nbsp;q</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>rem</span><span style='color: #660'>(</span><span style='color: #666'>a2</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>y</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>q</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;x1&nbsp;=&nbsp;a1&nbsp;^&nbsp;n1&nbsp;mod&nbsp;p</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>x1</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>ModPower</span><span style='color: #660'>(</span><span style='color: #666'>a1</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>d1</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>p</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;x2&nbsp;=&nbsp;a2&nbsp;^&nbsp;n2&nbsp;mod&nbsp;q</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>x2</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>ModPower</span><span style='color: #660'>(</span><span style='color: #666'>a2</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>d2</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>q</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;for&nbsp;not&nbsp;to&nbsp;have&nbsp;errors&nbsp;(?!)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>p</span>&nbsp;<span style='color: #909'>&lt;</span>&nbsp;<span style='color: #666'>q</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;v&nbsp;=&nbsp;p&nbsp;^&nbsp;-1&nbsp;mod&nbsp;q</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>v</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>InvMod</span><span style='color: #660'>(</span><span style='color: #666'>p</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>q</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;w&nbsp;=&nbsp;v&nbsp;mod&nbsp;q</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>rem</span><span style='color: #660'>(</span><span style='color: #666'>w</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>v</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>q</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;x&nbsp;=&nbsp;diff&nbsp;*&nbsp;w&nbsp;mod&nbsp;q</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>rem</span><span style='color: #660'>(</span><span style='color: #900'>x</span><span style='color: #999'>,</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>x2</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #666'>x1</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #666'>w</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>q</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;a</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>a</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>x1</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #666'>p</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #666'>x</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;v&nbsp;=&nbsp;q&nbsp;^&nbsp;-1&nbsp;mod&nbsp;p</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>v</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>InvMod</span><span style='color: #660'>(</span><span style='color: #666'>q</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>p</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;w&nbsp;=&nbsp;v&nbsp;mod&nbsp;p</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>rem</span><span style='color: #660'>(</span><span style='color: #666'>w</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>v</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>p</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;x&nbsp;=&nbsp;diff&nbsp;*&nbsp;w&nbsp;mod&nbsp;p</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>rem</span><span style='color: #660'>(</span><span style='color: #900'>x</span><span style='color: #999'>,</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>x1</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #666'>x2</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #666'>w</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>p</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;a</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>a</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>x2</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #666'>p</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #666'>x</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;write&nbsp;answer</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fa</span>&nbsp;<span style='color: #909'>&lt;&lt;</span>&nbsp;<span style='color: #666'>a</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyDecrypt]&nbsp;Could&nbsp;not&nbsp;write&nbsp;plain&nbsp;a"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><span style='color: #990'>}</span><br /><br /><span style='color: #060'>//&nbsp;finds&nbsp;if&nbsp;l,&nbsp;d&nbsp;can&nbsp;be&nbsp;the&nbsp;l&nbsp;and&nbsp;d&nbsp;in&nbsp;e&nbsp;*&nbsp;d&nbsp;-&nbsp;1&nbsp;=&nbsp;l&nbsp;*&nbsp;phi(n)</span><br /><span style='color: #009'>bool</span>&nbsp;<span style='color: #009'>RSA</span><span style='color: #909'>::</span><span style='color: #900'>criteria</span><span style='color: #660'>(</span><span style='color: #666'>ZZ</span>&nbsp;<span style='color: #666'>l</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>ZZ</span>&nbsp;<span style='color: #666'>d</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>ZZ</span>&nbsp;<span style='color: #666'>n</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>ZZ</span>&nbsp;<span style='color: #666'>e</span><span style='color: #660'>)</span><br /><span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ZZ</span>&nbsp;<span style='color: #666'>a</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>b</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>r</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>t</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>r1</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>r2</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>q1</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>q2</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;a&nbsp;is&nbsp;n</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>a</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>n</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;remainder&nbsp;of&nbsp;(e&nbsp;*&nbsp;d&nbsp;-&nbsp;1)&nbsp;/&nbsp;l</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>l</span>&nbsp;<span style='color: #909'>!=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>rem</span><span style='color: #660'>(</span><span style='color: #666'>r</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>e</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #666'>d</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #066'>1</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>l</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span>&nbsp;<span style='color: #066'>false</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;test&nbsp;if&nbsp;r&nbsp;is&nbsp;zero</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>r</span>&nbsp;<span style='color: #909'>!=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span>&nbsp;<span style='color: #066'>false</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//cout&nbsp;&lt;&lt;&nbsp;"rest&nbsp;=&nbsp;"&nbsp;&lt;&lt;&nbsp;r&nbsp;&lt;&lt;&nbsp;'\n';</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;quotient&nbsp;of&nbsp;(e&nbsp;*&nbsp;d&nbsp;-&nbsp;1)&nbsp;/&nbsp;l</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>l</span>&nbsp;<span style='color: #909'>!=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>div</span><span style='color: #660'>(</span><span style='color: #666'>b</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>e</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #666'>d</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #066'>1</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>l</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span>&nbsp;<span style='color: #066'>false</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//cout&nbsp;&lt;&lt;&nbsp;"ed-1/l&nbsp;=&nbsp;"&nbsp;&lt;&lt;&nbsp;b&nbsp;&lt;&lt;&nbsp;'\n';</span><br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;delta&nbsp;=&nbsp;b&nbsp;^&nbsp;2</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>b</span>&nbsp;<span style='color: #909'>&gt;=</span>&nbsp;<span style='color: #666'>a</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>t</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>b</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #666'>a</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>b</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #666'>a</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>t</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>a</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #066'>1</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #666'>b</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>a</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #066'>1</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #666'>b</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//cout&nbsp;&lt;&lt;&nbsp;"b2&nbsp;=&nbsp;"&nbsp;&lt;&lt;&nbsp;t&nbsp;&lt;&lt;&nbsp;'\n';</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;delta&nbsp;=&nbsp;delta&nbsp;-&nbsp;4&nbsp;*&nbsp;a&nbsp;*&nbsp;c</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>t</span>&nbsp;<span style='color: #909'>&gt;=</span>&nbsp;<span style='color: #066'>4</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #666'>a</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>t</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>t</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #066'>4</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #666'>a</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span>&nbsp;<span style='color: #066'>false</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//cout&nbsp;&lt;&lt;&nbsp;"b2-4ac&nbsp;=&nbsp;"&nbsp;&lt;&lt;&nbsp;t&nbsp;&lt;&lt;&nbsp;'\n';</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;test&nbsp;if&nbsp;delta&nbsp;is&nbsp;something&nbsp;squared</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>SqrRoot</span><span style='color: #660'>(</span><span style='color: #666'>t</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #900'>SqrRoot</span><span style='color: #660'>(</span><span style='color: #666'>t</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>!=</span>&nbsp;<span style='color: #666'>t</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span>&nbsp;<span style='color: #066'>false</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//cout&nbsp;&lt;&lt;&nbsp;"rad(delta)&nbsp;=&nbsp;"&nbsp;&lt;&lt;&nbsp;SqrRoot(t)&nbsp;&lt;&lt;&nbsp;'\n';</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;quotient</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>rem</span><span style='color: #660'>(</span><span style='color: #666'>r1</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>a</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #066'>1</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #666'>b</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #900'>SqrRoot</span><span style='color: #660'>(</span><span style='color: #666'>t</span><span style='color: #660'>)</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>to_ZZ</span><span style='color: #660'>(</span><span style='color: #066'>2</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>rem</span><span style='color: #660'>(</span><span style='color: #666'>r2</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>a</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #066'>1</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #666'>b</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #900'>SqrRoot</span><span style='color: #660'>(</span><span style='color: #666'>t</span><span style='color: #660'>)</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>to_ZZ</span><span style='color: #660'>(</span><span style='color: #066'>2</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;remainder</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>div</span><span style='color: #660'>(</span><span style='color: #666'>q1</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>a</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #066'>1</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #666'>b</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #900'>SqrRoot</span><span style='color: #660'>(</span><span style='color: #666'>t</span><span style='color: #660'>)</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>to_ZZ</span><span style='color: #660'>(</span><span style='color: #066'>2</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>div</span><span style='color: #660'>(</span><span style='color: #666'>q2</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>a</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #066'>1</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #666'>b</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #900'>SqrRoot</span><span style='color: #660'>(</span><span style='color: #666'>t</span><span style='color: #660'>)</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>to_ZZ</span><span style='color: #660'>(</span><span style='color: #066'>2</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//cout&nbsp;&lt;&lt;&nbsp;"rest(-b+rad(delta)/2a)&nbsp;=&nbsp;"&nbsp;&lt;&lt;&nbsp;r1&nbsp;&lt;&lt;&nbsp;";&nbsp;cat(-b+rad(delta)/2a)&nbsp;=&nbsp;"&nbsp;&lt;&lt;&nbsp;q1&nbsp;&lt;&lt;&nbsp;'\n';</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//cout&nbsp;&lt;&lt;&nbsp;"rest(-b-rad(delta)/2a)&nbsp;=&nbsp;"&nbsp;&lt;&lt;&nbsp;r2&nbsp;&lt;&lt;&nbsp;";&nbsp;cat(-b-rad(delta)/2a)&nbsp;=&nbsp;"&nbsp;&lt;&lt;&nbsp;q2&nbsp;&lt;&lt;&nbsp;'\n';</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;test&nbsp;if&nbsp;at&nbsp;least&nbsp;one&nbsp;solution&nbsp;exists</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>r1</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #066'>0</span>&nbsp;<span style='color: #909'>&&</span>&nbsp;<span style='color: #666'>q1</span>&nbsp;<span style='color: #909'>&gt;=</span>&nbsp;<span style='color: #066'>0</span>&nbsp;<span style='color: #909'>||</span>&nbsp;<span style='color: #666'>r2</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #066'>0</span>&nbsp;<span style='color: #909'>&&</span>&nbsp;<span style='color: #666'>q2</span>&nbsp;<span style='color: #909'>&gt;=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span>&nbsp;<span style='color: #066'>true</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//cout&nbsp;&lt;&lt;&nbsp;"rest(-b+rad(delta)/2a)&nbsp;=&nbsp;"&nbsp;&lt;&lt;&nbsp;r&nbsp;&lt;&lt;&nbsp;'\n';</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span>&nbsp;<span style='color: #066'>true</span><span style='color: #999'>;</span><br /><span style='color: #990'>}</span><br /><br /><span style='color: #060'>//&nbsp;applies&nbsp;Wiener&nbsp;decryption</span><br /><span style='color: #009'>void</span>&nbsp;<span style='color: #009'>RSA</span><span style='color: #909'>::</span><span style='color: #900'>applyWienerDecrypt</span><span style='color: #660'>(</span><span style='color: #009'>istream</span>&nbsp;<span style='color: #909'>&</span><span style='color: #666'>fc</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>istream</span>&nbsp;<span style='color: #909'>&</span><span style='color: #666'>fp</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>ostream</span>&nbsp;<span style='color: #909'>&</span><span style='color: #666'>fa</span><span style='color: #660'>)</span><br /><span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ZZ</span>&nbsp;<span style='color: #666'>n</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>e</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>d</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>f</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>y</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>i</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>l</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>a</span><span style='color: #909'>[</span><span style='color: #066'>3</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>b</span><span style='color: #909'>[</span><span style='color: #066'>3</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>q</span><span style='color: #909'>[</span><span style='color: #066'>3</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>r</span><span style='color: #909'>[</span><span style='color: #066'>3</span><span style='color: #909'>]</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;read&nbsp;in&nbsp;public&nbsp;n</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fp</span>&nbsp;<span style='color: #909'>&gt;&gt;</span>&nbsp;<span style='color: #666'>n</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyWienerDecrypt]&nbsp;Could&nbsp;not&nbsp;read&nbsp;public&nbsp;n"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;read&nbsp;in&nbsp;public&nbsp;e</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fp</span>&nbsp;<span style='color: #909'>&gt;&gt;</span>&nbsp;<span style='color: #666'>e</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyWienerDecrypt]&nbsp;Could&nbsp;not&nbsp;read&nbsp;public&nbsp;e"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;read&nbsp;in&nbsp;encrypted&nbsp;y</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fc</span>&nbsp;<span style='color: #909'>&gt;&gt;</span>&nbsp;<span style='color: #666'>y</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyWienerDecrypt]&nbsp;Could&nbsp;not&nbsp;read&nbsp;encrypted&nbsp;y"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;test&nbsp;y</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>y</span>&nbsp;<span style='color: #909'>&lt;=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyWienerDecrypt]&nbsp;Encrypted&nbsp;y&nbsp;is&nbsp;too&nbsp;small"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//n&nbsp;=&nbsp;8999999;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//e&nbsp;=&nbsp;3174353;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//cout&nbsp;&lt;&lt;&nbsp;"e&nbsp;=&nbsp;"&nbsp;&lt;&lt;&nbsp;e&nbsp;&lt;&lt;&nbsp;'\n';</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;set&nbsp;i&nbsp;to&nbsp;0</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>i</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>do</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;increment&nbsp;i</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>i</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>i</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #066'>1</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;update&nbsp;all</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>a</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>a</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>a</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>a</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>b</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>b</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>b</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>b</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>q</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>q</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>q</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>q</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>r</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>r</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>r</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>r</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;q&nbsp;i,&nbsp;r&nbsp;i,&nbsp;alpha&nbsp;i,&nbsp;beta&nbsp;i&nbsp;for&nbsp;different&nbsp;cases</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>i</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>div</span><span style='color: #660'>(</span><span style='color: #666'>q</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>e</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>n</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>rem</span><span style='color: #660'>(</span><span style='color: #666'>r</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>e</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>n</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>a</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>q</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>b</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>to_ZZ</span><span style='color: #660'>(</span><span style='color: #066'>1</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span>&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>i</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #066'>2</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>r</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span>&nbsp;<span style='color: #909'>&gt;</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>div</span><span style='color: #660'>(</span><span style='color: #666'>q</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>n</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>r</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>rem</span><span style='color: #660'>(</span><span style='color: #666'>r</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>n</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>r</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>break</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>a</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>q</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #666'>q</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #066'>1</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>b</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>q</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>r</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span>&nbsp;<span style='color: #909'>&gt;</span>&nbsp;<span style='color: #066'>0</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>div</span><span style='color: #660'>(</span><span style='color: #666'>q</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>r</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>r</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>rem</span><span style='color: #660'>(</span><span style='color: #666'>r</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>r</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>r</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>break</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>a</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>q</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #666'>a</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #666'>a</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>b</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>q</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #666'>b</span><span style='color: #909'>[</span><span style='color: #066'>1</span><span style='color: #909'>]</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #666'>b</span><span style='color: #909'>[</span><span style='color: #066'>0</span><span style='color: #909'>]</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//cout&nbsp;&lt;&lt;&nbsp;"i&nbsp;=&nbsp;"&nbsp;&lt;&lt;&nbsp;i&nbsp;&lt;&lt;&nbsp;'\n';&nbsp;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>while</span><span style='color: #660'>(</span><span style='color: #900'>criteria</span><span style='color: #660'>(</span><span style='color: #666'>a</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>b</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>n</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>e</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #066'>false</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//cout&nbsp;&lt;&lt;&nbsp;"d&nbsp;=&nbsp;"&nbsp;&lt;&lt;&nbsp;b[2]&nbsp;&lt;&lt;&nbsp;'\n';</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;answer</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>f</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>ModPower</span><span style='color: #660'>(</span><span style='color: #666'>y</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>b</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>n</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;write&nbsp;answer</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fa</span>&nbsp;<span style='color: #909'>&lt;&lt;</span>&nbsp;<span style='color: #666'>f</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyWienerDecrypt]&nbsp;Could&nbsp;not&nbsp;write&nbsp;plain&nbsp;a"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;write&nbsp;answer</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fa</span>&nbsp;<span style='color: #909'>&lt;&lt;</span>&nbsp;'\<span style='color: #666'>n</span>'<span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyWienerDecrypt]&nbsp;Could&nbsp;not&nbsp;write&nbsp;enter"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;write&nbsp;answer</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fa</span>&nbsp;<span style='color: #909'>&lt;&lt;</span>&nbsp;<span style='color: #666'>b</span><span style='color: #909'>[</span><span style='color: #066'>2</span><span style='color: #909'>]</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyWienerDecrypt]&nbsp;Could&nbsp;not&nbsp;write&nbsp;secret&nbsp;d"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><span style='color: #990'>}</span><br /><br /><span style='color: #060'>//&nbsp;divides&nbsp;into&nbsp;factors</span><br /><span style='color: #009'>void</span>&nbsp;<span style='color: #009'>RSA</span><span style='color: #909'>::</span><span style='color: #900'>applyFactors</span><span style='color: #660'>(</span><span style='color: #009'>istream</span>&nbsp;<span style='color: #909'>&</span><span style='color: #666'>fp</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>istream</span>&nbsp;<span style='color: #909'>&</span><span style='color: #666'>fs</span><span style='color: #999'>,</span>&nbsp;<span style='color: #009'>ostream</span>&nbsp;<span style='color: #909'>&</span><span style='color: #666'>fa</span><span style='color: #660'>)</span><br /><span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>ZZ</span>&nbsp;<span style='color: #666'>p</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>q</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>n</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>e</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>d</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>f</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>r</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>v</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>x</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>u</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>w</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>long</span>&nbsp;<span style='color: #666'>m</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>s</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;read&nbsp;in&nbsp;public&nbsp;n</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fp</span>&nbsp;<span style='color: #909'>&gt;&gt;</span>&nbsp;<span style='color: #666'>n</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyFactors]&nbsp;Could&nbsp;not&nbsp;read&nbsp;public&nbsp;n"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;read&nbsp;in&nbsp;public&nbsp;e</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fp</span>&nbsp;<span style='color: #909'>&gt;&gt;</span>&nbsp;<span style='color: #666'>e</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyFactors]&nbsp;Could&nbsp;not&nbsp;read&nbsp;public&nbsp;e"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;read&nbsp;in&nbsp;secret&nbsp;p&nbsp;but&nbsp;skip&nbsp;it</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fs</span>&nbsp;<span style='color: #909'>&gt;&gt;</span>&nbsp;<span style='color: #666'>f</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyFactors]&nbsp;Could&nbsp;not&nbsp;read&nbsp;secret&nbsp;p"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;read&nbsp;in&nbsp;secret&nbsp;q&nbsp;but&nbsp;skip&nbsp;it</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fs</span>&nbsp;<span style='color: #909'>&gt;&gt;</span>&nbsp;<span style='color: #666'>f</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyFactors]&nbsp;Could&nbsp;not&nbsp;read&nbsp;secret&nbsp;q"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;read&nbsp;in&nbsp;secret&nbsp;d</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fs</span>&nbsp;<span style='color: #909'>&gt;&gt;</span>&nbsp;<span style='color: #666'>d</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyFactors]&nbsp;Could&nbsp;not&nbsp;read&nbsp;secret&nbsp;d"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;e&nbsp;*&nbsp;d&nbsp;-&nbsp;1&nbsp;and&nbsp;redundance</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>r</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>e</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #666'>d</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #066'>1</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;mod&nbsp;2&nbsp;remainder</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>rem</span><span style='color: #660'>(</span><span style='color: #666'>v</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>r</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>to_ZZ</span><span style='color: #660'>(</span><span style='color: #066'>2</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;while&nbsp;v&nbsp;is&nbsp;even</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>for</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>s</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>;</span>&nbsp;<span style='color: #666'>v</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>;</span>&nbsp;<span style='color: #909'>++</span><span style='color: #666'>s</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;divide&nbsp;v</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>div</span><span style='color: #660'>(</span><span style='color: #666'>r</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>r</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>to_ZZ</span><span style='color: #660'>(</span><span style='color: #066'>2</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;mod&nbsp;2&nbsp;remainder</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>rem</span><span style='color: #660'>(</span><span style='color: #666'>v</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>r</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>to_ZZ</span><span style='color: #660'>(</span><span style='color: #066'>2</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;redundancy</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>m</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>s</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;generate&nbsp;random&nbsp;values&nbsp;for&nbsp;x</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>while</span>&nbsp;<span style='color: #660'>(</span><span style='color: #066'>1</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;reload&nbsp;s</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>s</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #666'>m</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;generate&nbsp;random&nbsp;x&nbsp;from&nbsp;Zn*</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>x</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>RandomBnd</span><span style='color: #660'>(</span><span style='color: #666'>n</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>while</span>&nbsp;<span style='color: #660'>(</span><span style='color: #900'>GCD</span><span style='color: #660'>(</span><span style='color: #666'>x</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>n</span><span style='color: #660'>)</span>&nbsp;<span style='color: #909'>!=</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>x</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>RandomBnd</span><span style='color: #660'>(</span><span style='color: #666'>n</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;2&nbsp;^&nbsp;s&nbsp;in&nbsp;w</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>power</span><span style='color: #660'>(</span><span style='color: #666'>w</span><span style='color: #999'>,</span>&nbsp;<span style='color: #066'>2</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>s</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;iterate&nbsp;through&nbsp;s</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>for</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>--</span><span style='color: #666'>s</span><span style='color: #999'>;</span>&nbsp;<span style='color: #666'>s</span>&nbsp;<span style='color: #909'>&gt;=</span>&nbsp;<span style='color: #066'>0</span><span style='color: #999'>;</span>&nbsp;<span style='color: #909'>--</span><span style='color: #666'>s</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;divide&nbsp;w</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>div</span><span style='color: #660'>(</span><span style='color: #666'>w</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>w</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>to_ZZ</span><span style='color: #660'>(</span><span style='color: #066'>2</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;x&nbsp;^&nbsp;(2&nbsp;^&nbsp;s&nbsp;*&nbsp;r)&nbsp;mod&nbsp;n&nbsp;in&nbsp;u</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>u</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>ModPower</span><span style='color: #660'>(</span><span style='color: #666'>x</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>w</span>&nbsp;<span style='color: #909'>*</span>&nbsp;<span style='color: #666'>r</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>n</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//non-trivial</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>u</span>&nbsp;<span style='color: #909'>!=</span>&nbsp;<span style='color: #066'>1</span>&nbsp;<span style='color: #909'>&&</span>&nbsp;<span style='color: #666'>u</span>&nbsp;<span style='color: #909'>!=</span>&nbsp;<span style='color: #666'>n</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;p</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #666'>p</span>&nbsp;<span style='color: #f00'>=</span>&nbsp;<span style='color: #900'>GCD</span><span style='color: #660'>(</span><span style='color: #666'>u</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #066'>1</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>n</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;compute&nbsp;q</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #900'>div</span><span style='color: #660'>(</span><span style='color: #666'>q</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>n</span><span style='color: #999'>,</span>&nbsp;<span style='color: #900'>GCD</span><span style='color: #660'>(</span><span style='color: #666'>u</span>&nbsp;<span style='color: #909'>+</span>&nbsp;<span style='color: #066'>1</span><span style='color: #999'>,</span>&nbsp;<span style='color: #666'>n</span><span style='color: #660'>)</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;write&nbsp;answer</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fa</span>&nbsp;<span style='color: #909'>&lt;&lt;</span>&nbsp;<span style='color: #666'>p</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyFactors]&nbsp;Could&nbsp;not&nbsp;write&nbsp;factor&nbsp;p"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;write&nbsp;answer</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fa</span>&nbsp;<span style='color: #909'>&lt;&lt;</span>&nbsp;'\<span style='color: #666'>n</span>'<span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyFactors]&nbsp;Could&nbsp;not&nbsp;write&nbsp;enter"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;write&nbsp;answer</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #909'>!</span><span style='color: #660'>(</span><span style='color: #666'>fa</span>&nbsp;<span style='color: #909'>&lt;&lt;</span>&nbsp;<span style='color: #666'>q</span><span style='color: #660'>)</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>throw</span><span style='color: #660'>(</span><span style='color: #090'>"[RSA::applyFactors]&nbsp;Could&nbsp;not&nbsp;write&nbsp;factor&nbsp;q"</span><span style='color: #660'>)</span><span style='color: #999'>;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;finished</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>return</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #060'>//&nbsp;otherwise</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>if</span>&nbsp;<span style='color: #660'>(</span><span style='color: #666'>u</span>&nbsp;<span style='color: #909'>==</span>&nbsp;<span style='color: #666'>n</span>&nbsp;<span style='color: #909'>-</span>&nbsp;<span style='color: #066'>1</span><span style='color: #660'>)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #009'>break</span><span style='color: #999'>;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style='color: #990'>}</span><br /><span style='color: #990'>}</span><br /><hr /><b>Definitii de functii (antet)</b><hr />void&nbsp;RSA::applyEncrypt(istream&nbsp;&fc,&nbsp;istream&nbsp;&fp,&nbsp;ostream&nbsp;&fa)<br /><br />void&nbsp;RSA::applyDecrypt(istream&nbsp;&fc,&nbsp;istream&nbsp;&fp,&nbsp;istream&nbsp;&fs,&nbsp;ostream&nbsp;&fa)<br /><br />bool&nbsp;RSA::criteria(ZZ&nbsp;l,&nbsp;ZZ&nbsp;d,&nbsp;ZZ&nbsp;n,&nbsp;ZZ&nbsp;e)<br /><br />void&nbsp;RSA::applyWienerDecrypt(istream&nbsp;&fc,&nbsp;istream&nbsp;&fp,&nbsp;ostream&nbsp;&fa)<br /><br />void&nbsp;RSA::applyFactors(istream&nbsp;&fp,&nbsp;istream&nbsp;&fs,&nbsp;ostream&nbsp;&fa)<br /><br /><hr /><b>Apeluri de functii si de cate ori</b><hr />to_ZZ de 10 ori<br />NumBits o data<br />ZZ::SqrMod o data<br />bit o data<br />MulMod o data<br />ModPower de 5 ori<br />InvMod de 2 ori<br />x de 2 ori<br />rem de 5 ori<br />div de 5 ori<br />SqrRoot de 5 ori<br />criteria o data<br />RandomBnd de 2 ori<br />GCD de 3 ori<br /><hr /><b>Tipuri predefinite utilizate</b><hr />long<br />void<br />istream<br />ostream<br />bool<br /><hr /><b>Tipuri noi</b><hr />RSA<br /></body></html>